<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Live Viewers Monitor</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: white;
      text-align: center;
      padding: 20px;
    }
    .channel {
      background: #222;
      border-radius: 10px;
      padding: 20px;
      margin: 10px auto;
      max-width: 400px;
      font-size: 1.4rem;
    }
    .channel-name {
      font-weight: bold;
      font-size: 1.8rem;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <h1>üì° Live Viewers Monitor</h1>
  <button onclick="solicitarPermisoNotificaciones()">üîî Permitir Notificaciones</button>
  <div id="channels"></div>

  <script>
    // üëá Aqu√≠ defines los canales y el m√≠nimo de viewers antes de lanzar la notificaci√≥n
    const canales = {
      "talona1": 200,     // Notificar√° si baja de 12 viewers
      "deftsulol": 149,   // Notificar√° si baja de 20
      "role7": 200,        // Notificar√° si baja de 5
      "elflaco": 200      // Notificar√° si baja de 15
    };

    const lastViewers = {};
    const contenedor = document.getElementById("channels");

    // Genera los bloques visuales para cada canal
    for (const canal in canales) {
      const div = document.createElement("div");
      div.className = "channel";
      div.id = `canal-${canal}`;
      div.innerHTML = `<div class="channel-name">${canal}</div><div id="viewers-${canal}">Cargando...</div>`;
      contenedor.appendChild(div);
      lastViewers[canal] = null;
    }

    function solicitarPermisoNotificaciones() {
      if (Notification.permission !== "granted") {
        Notification.requestPermission().then(p => {
          if (p === "granted") {
            alert("‚úÖ Permiso de notificaciones concedido");
          }
        });
      }
    }

    function notificar(canal, viewers) {
      if (Notification.permission === "granted") {
        new Notification(`üîª ${canal}`, {
          body: `Viewers bajaron a ${viewers}`
        });
      }
    }

    async function obtenerViewers(canal) {
      try {
        const res = await fetch(`https://kicktools.app/api/viewers.php?kick=${canal}`);
        const data = await res.json();
        const viewers = parseInt(data.viewers);
        const div = document.getElementById(`viewers-${canal}`);
        div.textContent = `üëÅÔ∏è Viewers: ${viewers}`;

        const threshold = canales[canal]; // üëà Este es el valor personalizado para cada canal

        if (lastViewers[canal] !== null && viewers < threshold && lastViewers[canal] >= threshold) {
          notificar(canal, viewers);
        }

        lastViewers[canal] = viewers;
      } catch (e) {
        document.getElementById(`viewers-${canal}`).textContent = "‚ùå Error";
      }
    }

    setInterval(() => {
      for (const canal in canales) {
        obtenerViewers(canal);
      }
    }, 5000);

    solicitarPermisoNotificaciones(); // Pide permiso al cargar
  </script>
</body>
</html>
